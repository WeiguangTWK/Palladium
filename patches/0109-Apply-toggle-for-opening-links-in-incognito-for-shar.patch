From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: quh4gko8 <88831734+quh4gko8@users.noreply.github.com>
Date: Thu, 1 Feb 2024 17:58:40 +0000
Subject: [PATCH] Apply toggle for opening links in incognito for share intents

---
 .../org/chromium/chrome/browser/LaunchIntentDispatcher.java | 5 +++++
 .../chrome/browser/LaunchIntentDispatcherHooks.java         | 6 ++++++
 2 files changed, 11 insertions(+)

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcher.java b/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcher.java
index bdcf7ec1f2..5856f34065 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcher.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcher.java
@@ -335,6 +330,12 @@ public class LaunchIntentDispatcher {

         Intent newIntent = new Intent(mIntent);

+        if (Intent.ACTION_SEND.equals(newIntent.getAction())
+                && "text/plain".equals(newIntent.getType())) {
+            newIntent = LaunchIntentDispatcherHooks.maybeModifyActionSendIntents(
+                    mActivity, newIntent);
+        }
+
         if (Intent.ACTION_VIEW.equals(newIntent.getAction())
                 && !IntentHandler.wasIntentSenderChrome(newIntent)) {
             newIntent = LaunchIntentDispatcherHooks.maybeModifyActionViewIntents(mActivity, newIntent);
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcherHooks.java b/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcherHooks.java
index 6cdfa50279..547e85324c 100644
--- a/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcherHooks.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/LaunchIntentDispatcherHooks.java
@@ -35,4 +35,10 @@ final class LaunchIntentDispatcherHooks {

         return newIntent;
     }
+
+    static Intent maybeModifyActionSendIntents(Context context, Intent intent) {
+        Intent newIntent = maybeCreateIncognitoTabIntentFor(context, intent);
+
+        return newIntent;
+    }
 }
